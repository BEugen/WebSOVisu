function drawChart(t,a,e,o,i){$.ajax({url:a,data:{id:t,csrfmiddlewaretoken:i},timeout:3e5,type:"POST",beforeSend:function(){},success:function(n){$.plot("#ch_"+t,n,o),e||($("#ch_"+t).bind("plothover",function(t,a,e){if(e){var o=e.datapoint[0],i=e.datapoint[1].toFixed(2);$("#tooltip").html(e.series.label+":"+formatTime(o)+" = "+i).css({top:e.pageY+5,left:e.pageX-150}).fadeIn(200)}else $("#tooltip").hide()}),e=!0),window.setTimeout(function(){drawChart(t,a,e,o,i)},3e5)},error:function(){window.setTimeout(function(){drawChart(t,a,e,o,i)},3e5)}})}function drawtriangle(t){var a=$("#triangle"),e=$("#dv_triangle"),o=e.innerWidth(),i=e.innerHeight();i>o?i=o:o=i;var n=.5*o,l=.5*i,r=.95*n;e.width(o).height(i),a.width(o).height(i),a.attr("width",o).attr("height",i);var s=a.get(0).getContext("2d"),h=Math.PI/180*270,g=Math.PI/180*150,c=Math.PI/180*30,f=.3;s.beginPath(),s.moveTo(3*f*r*Math.cos(h)+n,3*f*r*Math.sin(h)+l),s.lineTo(3*f*r*Math.cos(g)+n,3*f*r*Math.sin(g)+l),s.lineTo(3*f*r*Math.cos(c)+n,3*f*r*Math.sin(c)+l),s.fillStyle="rgba(208, 75, 118, 0.6)",s.fill(),s.lineWidth=1,s.strokeStyle="rgba(208, 78, 118, 0.6)",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(.69*r*Math.cos(h)+n,.69*r*Math.sin(h)+l),s.lineTo(.69*r*Math.cos(g)+n,.69*r*Math.sin(g)+l),s.lineTo(.69*r*Math.cos(c)+n,.69*r*Math.sin(c)+l),s.fillStyle="rgba(255, 255, 255, 1.0)",s.fill(),s.lineWidth=1,s.strokeStyle="rgba(255, 255, 255, 1.0)",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(.69*r*Math.cos(h)+n,.69*r*Math.sin(h)+l),s.lineTo(.69*r*Math.cos(g)+n,.69*r*Math.sin(g)+l),s.lineTo(.69*r*Math.cos(c)+n,.69*r*Math.sin(c)+l),s.fillStyle="#ffffff",s.fillStyle="rgba(255, 110, 0, 0.1)",s.fill(),s.lineWidth=1,s.strokeStyle="rgba(255, 110, 0, 0.1)",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(.48*r*Math.cos(h)+n,.48*r*Math.sin(h)+l),s.lineTo(.48*r*Math.cos(g)+n,.48*r*Math.sin(g)+l),s.lineTo(.48*r*Math.cos(c)+n,.48*r*Math.sin(c)+l),s.fillStyle="rgba(255, 255, 255, 1.0)",s.fill(),s.lineWidth=1,s.strokeStyle="rgba(255, 255, 255, 1.0)",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(.48*r*Math.cos(h)+n,.48*r*Math.sin(h)+l),s.lineTo(.48*r*Math.cos(g)+n,.48*r*Math.sin(g)+l),s.lineTo(.48*r*Math.cos(c)+n,.48*r*Math.sin(c)+l),s.fillStyle="rgba(26, 255, 7, 0.25)",s.fill(),s.lineWidth=1,s.strokeStyle="rgba(26, 255, 7, 0.25)",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(n,l),s.lineTo(.95*r*Math.cos(h)+n,.95*r*Math.sin(h)+l),s.lineWidth=3,s.fillStyle="#525457",s.strokeStyle="#525457",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(n,l),s.lineTo(.95*r*Math.cos(g)+n,.95*r*Math.sin(g)+l),s.lineWidth=3,s.fillStyle="#525457",s.strokeStyle="#525457",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(n,l),s.lineTo(.95*r*Math.cos(c)+n,.95*r*Math.sin(c)+l),s.lineWidth=3,s.fillStyle="#525457",s.strokeStyle="#525457",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(drawgazoanalizators(t.ug,f,2.3,1.6,r)*Math.cos(h)+n,drawgazoanalizators(t.ug,f,2.3,1.6,r)*Math.sin(h)+l),s.lineTo(drawgazoanalizators(t.n,f,2.3,1.6,r)*Math.cos(g)+n,drawgazoanalizators(t.n,f,2.3,1.6,r)*Math.sin(g)+l),s.lineTo(drawgazoanalizators(t.m,f,2.3,1.6,r)*Math.cos(c)+n,drawgazoanalizators(t.m,f,2.3,1.6,r)*Math.sin(c)+l),s.lineTo(drawgazoanalizators(t.ug,f,2.3,1.6,r)*Math.cos(h)+n,drawgazoanalizators(t.ug,f,2.3,1.6,r)*Math.sin(h)+l),s.lineWidth=3,s.strokeStyle="#218EFF",s.stroke(),s.closePath(),s.beginPath(),s.moveTo(drawgazoanalizators_n(t.n_ug,t.v_ug,f,2.3,1.6,r)*Math.cos(h)+n,drawgazoanalizators_n(t.n_ug,t.v_ug,f,2.3,1.6,r)*Math.sin(h)+l),s.lineTo(drawgazoanalizators_n(t.n_n,t.v_n,f,2.3,1.6,r)*Math.cos(g)+n,drawgazoanalizators_n(t.n_n,t.v_n,f,2.3,1.6,r)*Math.sin(g)+l),s.lineTo(drawgazoanalizators_n(t.n_m,t.v_m,f,2.3,1.6,r)*Math.cos(c)+n,drawgazoanalizators_n(t.n_m,t.v_m,f,2.3,1.6,r)*Math.sin(c)+l),s.lineTo(drawgazoanalizators_n(t.n_ug,t.v_ug,f,2.3,1.6,r)*Math.cos(h)+n,drawgazoanalizators_n(t.n_ug,t.v_ug,f,2.3,1.6,r)*Math.sin(h)+l),s.lineWidth=3,s.strokeStyle="#42A831",s.stroke(),s.closePath(),drawvalue(s,t,n,l,r,o,i),a.show()}function drawvalue(t,a,e,o,i,n,l){var r=Math.PI/180*272,s=Math.PI/180*140,h=Math.PI/180*40;t.fillStyle=getcolor(a.ug);var g=i*Math.cos(r)+e,c=i*Math.sin(r)+o,f=.15*n,d=.05*l;t.fillRect(g,c,f,d),t.strokeStyle="#efeeef",t.lineWidth=1,t.strokeRect(g,c,f,d),t.font=.04*n+"pt Verdana",t.fillStyle="#efeeef",t.fillText(a.ug_q>=192?a.ug:"???",g+3,c+.9*d),t.fillText("УГМС",g-3.5*d,c+.9*d),ll=.77*i;var M=ll*Math.cos(s)+e,u=ll*Math.sin(s)+o,T=.15*n,w=.05*l;t.fillStyle=getcolor(a.n),t.fillRect(M,u,T,w),t.strokeStyle="#efeeef",t.lineWidth=1,t.strokeRect(M,u,T,w),t.fillStyle="#efeeef",t.fillText(a.n_q>=192?a.n:"???",M+3,u+.9*w),t.fillText("Нагор.",M-4*w,u+.9*w),ll=.78*i;var z=ll*Math.cos(h)+e,v=ll*Math.sin(h)+o,S=.15*n,m=.05*l;t.fillStyle=getcolor(a.m),t.fillRect(z,v,S,m),t.strokeStyle="#efeeef",t.lineWidth=1,t.strokeRect(z,v,S,m),t.fillStyle="#efeeef",t.fillText(a.m_q>=192?a.m:"???",z+3,v+.9*m),t.fillText("Молод.",z-4*m,v+.9*m)}function getcolor(t){return t<.3?"rgba(26, 255, 7, 0.3)":t>=.3&&t<.5?"rgba(255, 110, 0, 0.3)":"rgba(255, 17, 31, 0.15)"}function drawgazoanalizators(t,a,e,o,i){return t<.3?o*a*i/.4*(t+.1):t>=.3&&t<.5?(t-.3)*(e*a*i-o*a*i)/.2+o*a*i:t>.5?(t>1.5&&(t=1.5),(t-.5)*(3*a*i-e*a*i)+e*a*i):void 0}function drawgazoanalizators_n(t,a,e,o,i,n){return 0===t?i*e*n*a:1===t?(o*e*n-i*e*n)*a+i*e*n:2===t?(3*e*n-o*e*n)*a+o*e*n:void 0}function gettriangle(t,a){$.ajax({url:t,data:{id:0,csrfmiddlewaretoken:a},dataType:"json",timeout:1e4,type:"POST",beforeSend:function(){},success:function(e){drawtriangle(e),window.setTimeout(function(){gettriangle(t,a)},5e3)},error:function(){window.setTimeout(function(){gettriangle(t,a)},5e3)}})}function formatTime(t){var a=new Date(t),e=a.getMonth()+1,o=a.getMinutes(),i=a.getSeconds();return e<=9&&(e="0"+e),o<=9&&(o="0"+o),i<=9&&(i="0"+i)," "+a.getUTCDate()+"."+e+"."+a.getFullYear()+" "+a.getUTCHours()+":"+o}